<%
  # filters
  category_filters   = {}.with_indifferent_access
  status_filters     = {}.with_indifferent_access
  updated_at_filters = {}.with_indifferent_access
  archived_filters   = {}.with_indifferent_access
  locked_filters     = {}.with_indifferent_access

  # filter values
  Story.const.categories.each do |category|
    category_filters[category.category] = category.label
  end
  Story.const.statuses.each do |status|
    status_filters[status.status] = status.label
  end
  {
    "3 Hours"  => 3.hours.ago.beginning_of_hour,
    "6 Hours"  => 6.hours.ago.beginning_of_hour,
    "12 Hours" => 12.hours.ago.beginning_of_hour,
    "1 Day"    => 1.day.ago.to_date,
    "3 Days"   => 3.days.ago.to_date,
    "1 Week"   => 1.week.ago.to_date,
    "1 Month"  => 1.month.ago.to_date,
  }.each do |label, value|
    updated_at_filters[value.to_i.to_s] = label
  end
  archived_filters["true"] = "Archived"
  locked_filters["true"]   = "Locked"

  # filter ids
  category_filter_id   = "category_eq"
  status_filter_id     = "status_eq"
  updated_at_filter_id = "story_updated_at_gteq"
  archived_filter_id   = "is_archived_eq"
  locked_filter_id     = "is_locked_eq"

  # active filters
  active_category_filter   = params[category_filter_id]
  active_status_filter     = params[status_filter_id]
  active_updated_at_filter = params[updated_at_filter_id]
  active_archived_filter   = params[archived_filter_id]
  active_locked_filter     = params[locked_filter_id]
  actively_filtering       = [
    active_category_filter,
    active_status_filter,
    active_updated_at_filter,
    active_archived_filter,
    active_locked_filter,
  ].any?(&:present?)
%>


<%= cp.div_tag(class: "input-group story_filter") do %>
  <%= cp.div_tag(class: "input-group-btn") do %>
    <% toggle_params = actively_filtering ? { add_class: "btn-primary", remove_class: "btn-default" } : {} %>
    <%= cp.dropdown_toggle_btn(toggle_params) do %>
      <%= cp.icon("filter") %> <%= cp.caret_span %>
    <% end %>

    <%= cp.dropdown_menu_ul do %>
      <!-- category_filter -->
      <%= cp.li_tag(class: "dropdown-header", content: "Category") %>
      <% category_filters.each do |value, label| %>
        <%= cp.li_tag(add_class: ("active" if active_category_filter == value)) do %>
          <%= cp.a_tag(class: "radio") do %>
            <%= cp.label_tag do %>
              <%= cp.radio_button_tag(category_filter_id, content: value, id: nil) %>
              <%= cp.span_tag(content: label) %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <!-- updated_at_filter -->
      <%= cp.li_tag(class: "dropdown-header", content: "Updated Within") %>
      <% updated_at_filters.each do |value, label| %>
        <%= cp.li_tag(add_class: ("active" if active_updated_at_filter == value)) do %>
          <%= cp.a_tag(class: "radio") do %>
            <%= cp.label_tag do %>
              <%= cp.radio_button_tag(updated_at_filter_id, content: value, id: nil) %>
              <%= cp.span_tag(content: label) %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <!-- status_filter -->
      <%= cp.li_tag(class: "dropdown-header", content: "Status") %>
      <% status_filters.each do |value, label| %>
        <%= cp.li_tag(add_class: ("active" if active_status_filter == value)) do %>
          <%= cp.a_tag(class: "radio") do %>
            <%= cp.label_tag do %>
              <%= cp.radio_button_tag(status_filter_id, content: value, id: nil) %>
              <%= cp.span_tag(content: label) %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

      <!-- admin filters -->
      <% if is_admin? %>
        <%= cp.li_tag(class: "dropdown-header", content: "Options") %>
        <!-- archived_filter -->
        <% archived_filters.each do |value, label| %>
          <%= cp.li_tag(add_class: ("active" if active_archived_filter == value)) do %>
            <%= cp.a_tag(class: "checkbox") do %>
              <%= cp.label_tag do %>
                <%= cp.check_box_tag(archived_filter_id, content: "true") %>
                <%= cp.span_tag(content: label) %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>

        <!-- locked_filter -->
        <% locked_filters.each do |value, label| %>
          <%= cp.li_tag(add_class: ("active" if active_locked_filter == value)) do %>
            <%= cp.a_tag(class: "checkbox") do %>
              <%= cp.label_tag do %>
                <%= cp.check_box_tag(locked_filter_id, content: "true") %>
                <%= cp.span_tag(content: label) %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

    <% end %>
  <% end %>
  <%= cp.story_filter %>
<% end %>
